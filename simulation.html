<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>Wizgame</title>
    <script src="game.js"></script>
</head>

<body>
    <script>
        const game = new Game();
        const playerNames = ["Esther", "Troy", "Sabato", "Sander", "Heidi", "Tim"];
        const players= [];
        for(let names of playerNames) {
            const player = game.addPlayer(names);
            console.log(`Player ${names} joined the game.`);
            players.push(player);
        }

        // Drawing cards
        game.start();
        let round = 1;
        const cards = {};
        for(let player of players) {
            let temp = game.getCards(player).map(c => `${c[0]} ${c[1]}`)
            cards[player] = temp;
        }
        console.log(`Players drew the following cards:`)
        console.table(cards);

        while (round <= game.state.maxRounds) {
            // Playcing bids
            const bids = [];
            for(let player of players) {
                const bid = Math.floor(Math.random() * (round + 1)); 
                game.bid(player, bid);
                console.log(`Player ${player} bid ${bid}.`);
            }

            while(game.getCards(1).length) {
                // Playing cards
                for(let player of players) {
                    let valid = false;
                    let playing;
                    while(!valid) {
                        try {
                            playing = Math.floor((Math.random() * round));
                            game.playCard(player, playing);
                            valid = true;
                        } catch (error) {
                            if(error.message.startsWith("Wrong color")) valid = false;
                            else throw error;
                        }
                    }
                    console.log(`Player ${player} plays ${game.state.currentTrick[game.state.currentTrick.length - 1]}.`);
                    cards[player][playing]
                }
                players.push(players.shift()); 
            }  

            game.finishRound();
            console.log(`Finished round ${round++}:`);
            const scores = [];
            for(let player of players) {
                console.log(`Player ${player} has ${game.getScore(player)} points.`);
            }
        }
    </script>
</body>

</html>